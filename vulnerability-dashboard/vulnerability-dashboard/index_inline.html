<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index_enhanced.css">
    <title>Enhanced Vulnerability Dashboard</title>
</head>
<body>
    <div id="intro">
        <img src="resources/img/Icon.png" alt="Dashboard Icon">
    </div>

    <header>
        <img src="resources/img/Icon.png" alt="Icon">  
        <ul>
            <li>
                <button type="button" class="reportBtn btn-not-allowed" id="overview" disabled>Overview</button>
            </li>
            <li>
                <button type="button" class="reportBtn btn-not-allowed" id="sast" disabled>SAST</button>
            </li>
            <!-- New button for Secret Detection -->
            <li>
                <button type="button" class="reportBtn btn-not-allowed" id="secret-detection" disabled>Secret Detection</button>
            </li>
            <li>
                <button type="button" class="reportBtn btn-not-allowed" id="dependenncy-check" disabled>Dependency Check</button>
            </li>
            <li>
                <button type="button" class="reportBtn btn-not-allowed" id="container-scanning" disabled>Container Scanning</button>
            </li>
            <li>
                <button type="button" class="reportBtn btn-not-allowed" id="fuzzing" disabled>Fuzzing</button>
            </li>
            <li>
                <button type="button" class="reportBtn btn-not-allowed" id="dast" disabled>DAST</button>
            </li>
        </ul>    
    </header>
    <aside>
        <ul>
            <li>
                <button type="button" class="btn-allowed" id="last-pipeline-vul">Check Last Pipeline Vulnerabilities</button>
            </li>
            <li>
                <button type="button" class="btn-allowed" id="pre-vul">Check Previous Vulnerabilities</button>
            </li>
            <li>
                <button type="button" class="btn-allowed" id="change-config">Change Target Config</button>
            </li>
        </ul>    
    </aside>
    <main class="inline-flex center ch-bgrd-color-transition">
        <h1>Pipeline not selected</h1>
    </main>

    <script type="module">
        // Enhanced render.js with artifact data integration - inline version
        
        //GLOBAL VAR//
        //page enum
        const BASE_PAGE = 0;
        const CONFIG_PAGE = 1;
        const OVERVIEW_PAGE = 2;
        const SAST_PAGE = 3;
        const SECRET_DETECTION_PAGE = 4; // New page constant for Secret Detection
        const D_CHECK_PAGE = 5;
        const CONT_SCAN_PAGE = 6;
        const FUZZING_PAGE = 7;
        const DAST_PAGE = 8;
        const LASTPVUL_PAGE = 9;
        let currentPage = BASE_PAGE;

        const BTN_ALLOWED = "btn-not-allowed";
        const BTN_NOT_ALLOWED = "btn-allowed";
        const BTN_ALLOWED_ACTIVE = "btn-allowed-active";

        // Mock data structure for demonstration
        // This structure will be populated by actual data loaded from the artifacts/ directory
        const mockArtifactData = {
            juiceshop: {
                sast: {
                    vulnerabilities: [
                        { severity: "HIGH", type: "SQL Injection", file: "app.js", line: 42, description: "Potential SQL injection vulnerability" },
                        { severity: "MEDIUM", type: "XSS", file: "login.html", line: 15, description: "Cross-site scripting vulnerability" },
                        { severity: "LOW", type: "Hardcoded Secret", file: "config.js", line: 8, description: "Hardcoded API key found" }
                    ],
                    summary: { high: 1, medium: 1, low: 1, total: 3 }
                },
                // Added Secret Detection data structure
                secret_detection: {
                    vulnerabilities: [
                        { severity: "HIGH", type: "Hardcoded API Key", file: "src/main.js", line: 10, description: "API key found in source code" },
                        { severity: "MEDIUM", type: "Exposed Private Key", file: "config/keys.js", line: 5, description: "Private key exposed in repository" }
                    ],
                    summary: { high: 1, medium: 1, low: 0, total: 2 }
                },
                dast: {
                    vulnerabilities: [
                        { severity: "HIGH", type: "Authentication Bypass", url: "/admin", description: "Admin panel accessible without authentication" },
                        { severity: "MEDIUM", type: "Information Disclosure", url: "/api/users", description: "Sensitive user data exposed" }
                    ],
                    summary: { high: 1, medium: 1, low: 0, total: 2 }
                },
                dependency_scanning: {
                    vulnerabilities: [
                        { severity: "HIGH", package: "lodash", version: "4.17.15", cve: "CVE-2020-8203", description: "Prototype pollution vulnerability" },
                        { severity: "MEDIUM", package: "express", version: "4.16.4", cve: "CVE-2019-5413", description: "Open redirect vulnerability" }
                    ],
                    summary: { high: 1, medium: 1, low: 0, total: 2 }
                },
                container_scanning: {
                    vulnerabilities: [
                        { severity: "HIGH", package: "openssl", version: "1.1.1", cve: "CVE-2021-3711", description: "Buffer overflow in SM2 decryption" }
                    ],
                    summary: { high: 1, medium: 0, low: 0, total: 1 }
                },
                fuzzing: {
                    vulnerabilities: [
                        { severity: "MEDIUM", endpoint: "/api/search", description: "Input validation bypass detected" }
                    ],
                    summary: { high: 0, medium: 1, low: 0, total: 1 }
                }
            },
            todoapp: {
                sast: {
                    vulnerabilities: [
                        { severity: "MEDIUM", type: "Path Traversal", file: "fileHandler.js", line: 23, description: "Potential path traversal vulnerability" }
                    ],
                    summary: { high: 0, medium: 1, low: 0, total: 1 }
                },
                // Added empty secret_detection for todoapp
                secret_detection: {
                    vulnerabilities: [],
                    summary: { high: 0, medium: 0, low: 0, total: 0 }
                },
                dast: {
                    vulnerabilities: [
                        { severity: "LOW", type: "Missing Security Headers", url: "/", description: "Missing X-Frame-Options header" }
                    ],
                    summary: { high: 0, medium: 0, low: 1, total: 1 }
                },
                dependency_scanning: {
                    vulnerabilities: [],
                    summary: { high: 0, medium: 0, low: 0, total: 0 }
                },
                container_scanning: {
                    vulnerabilities: [],
                    summary: { high: 0, medium: 0, low: 0, total: 0 }
                },
                fuzzing: {
                    vulnerabilities: [],
                    summary: { high: 0, medium: 0, low: 0, total: 0 }
                }
            }
        };

        // Function to load artifact data from local files
        async function loadArtifactData() {
            const projects = ["juiceshop", "todoapp"];
            const artifactTypes = [
                "sast", 
                "secret_detection", // Include secret detection
                "dast", 
                "dependency_scanning", 
                "container_scanning", 
                "fuzzing"
            ];

            for (const project of projects) {
                for (const type of artifactTypes) {
                    const filePath = `./artifacts/${project}_${type}.json`;
                    try {
                        const response = await fetch(filePath);
                        if (response.ok) {
                            const data = await response.json();
                            // Store the loaded data in mockArtifactData
                            if (!mockArtifactData[project]) mockArtifactData[project] = {};
                            mockArtifactData[project][type] = processGitLabReport(data, type); // Process the report
                            console.log(`Loaded ${type} data for ${project} from ${filePath}`);
                        } else {
                            console.warn(`Could not load ${type} data for ${project} from ${filePath}: ${response.statusText}`);
                            // If file not found, ensure mock data is empty
                            if (!mockArtifactData[project]) mockArtifactData[project] = {};
                            mockArtifactData[project][type] = { vulnerabilities: [], summary: { high: 0, medium: 0, low: 0, total: 0 } };
                        }
                    } catch (error) {
                        console.error(`Error loading ${type} data for ${project} from ${filePath}:`, error);
                        if (!mockArtifactData[project]) mockArtifactData[project] = {};
                        mockArtifactData[project][type] = { vulnerabilities: [], summary: { high: 0, medium: 0, low: 0, total: 0 } };
                    }
                }
            }
        }

        // Function to process GitLab report format into dashboard-friendly format
        function processGitLabReport(report, type) {
            const vulnerabilities = [];
            const summary = { high: 0, medium: 0, low: 0, total: 0 };

            if (!report || !report.vulnerabilities) {
                return { vulnerabilities: [], summary: { high: 0, medium: 0, low: 0, total: 0 } };
            }

            report.vulnerabilities.forEach(vuln => {
                let severity = vuln.severity ? vuln.severity.toUpperCase() : 'UNKNOWN';
                // Map GitLab severities to dashboard categories
                if (severity === 'CRITICAL') severity = 'HIGH';
                if (severity === 'INFO') severity = 'LOW';

                // Increment summary counts
                if (severity === 'HIGH') summary.high++;
                else if (severity === 'MEDIUM') summary.medium++;
                else if (severity === 'LOW') summary.low++;
                else summary.low++; // Default unknown to low
                summary.total++;

                let location = 'N/A';
                let typeInfo = vuln.vulnerability_id || vuln.name || 'Unknown';

                // Extract location based on report type and available fields
                if (vuln.location) {
                    if (vuln.location.file && vuln.location.start_line) {
                        location = `${vuln.location.file}:${vuln.location.start_line}`;
                    } else if (vuln.location.url) {
                        location = vuln.location.url;
                    } else if (vuln.location.image) {
                        location = vuln.location.image;
                    } else if (vuln.location.dependency) {
                        location = `${vuln.location.dependency.package.name} (${vuln.location.dependency.version})`;
                    }
                }

                vulnerabilities.push({
                    severity: severity,
                    type: typeInfo,
                    location: location,
                    description: vuln.description || vuln.message || 'No description provided.'
                });
            });

            return { vulnerabilities, summary };
        }

        //Get buttons
        const btnOverview = document.getElementById("overview");
        const btnSast = document.getElementById("sast");
        const btnSecretDetection = document.getElementById("secret-detection"); // New button reference
        const btnDCheck = document.getElementById("dependenncy-check");
        const btnContainerScanning = document.getElementById("container-scanning");
        const btnFuzzing = document.getElementById("fuzzing");
        const btnDast = document.getElementById("dast");
        const btnLastPVul = document.getElementById("last-pipeline-vul");
        const btnPreVul = document.getElementById("pre-vul");
        const btnChConfig = document.getElementById("change-config");

        // Utility functions
        function removeCurrentPage() {
            const root = document.querySelector("main");
            while (root.firstChild) {
                root.removeChild(root.firstChild);
            }
        }

        function disableReportBtns(disableBtn) {
            const reportBtns = document.querySelectorAll(".reportBtn");
            
            if(reportBtns[0].disabled === disableBtn) 
                return;

            for(const btn of reportBtns) {
                btn.disabled = disableBtn;
                btn.classList.toggle(BTN_ALLOWED);
                btn.classList.toggle(BTN_NOT_ALLOWED);
            }
        }

        function removeSelector(selector, type = "", ...exceptions) {
            const nodesArray = document.querySelectorAll(type + selector);
            for(const node of nodesArray) {
                if(!exceptions.includes(node))
                    node.classList.remove(selector);
            }
        }

        function createProjectSelector() {
            const selector = document.createElement("div");
            selector.className = "project-selector";
            selector.innerHTML = `
                <h3>Select Project:</h3>
                <div class="project-buttons">
                    <button class="project-btn active" data-project="juiceshop">JuiceShop</button>
                    <button class="project-btn" data-project="todoapp">TodoApp</button>
                </div>
            `;
            
            // Add event listeners for project selection
            selector.querySelectorAll(".project-btn").forEach(btn => {
                btn.addEventListener("click", (e) => {
                    selector.querySelectorAll(".project-btn").forEach(b => b.classList.remove("active"));
                    e.target.classList.add("active");
                    // Trigger page refresh with new project data
                    const currentPageType = getCurrentPageType();
                    if (currentPageType !== "overview") {
                        refreshCurrentPage();
                    }
                });
            });
            
            return selector;
        }

        function getCurrentProject() {
            const activeBtn = document.querySelector(".project-btn.active");
            return activeBtn ? activeBtn.dataset.project : "juiceshop";
        }

        function getCurrentPageType() {
            if (currentPage === SAST_PAGE) return "sast";
            if (currentPage === SECRET_DETECTION_PAGE) return "secret_detection"; // Return new type
            if (currentPage === DAST_PAGE) return "dast";
            if (currentPage === D_CHECK_PAGE) return "dependency_scanning";
            if (currentPage === CONT_SCAN_PAGE) return "container_scanning";
            if (currentPage === FUZZING_PAGE) return "fuzzing";
            return "overview";
        }

        function refreshCurrentPage() {
            const pageType = getCurrentPageType();
            const main = document.querySelector("main");
            
            // Remove content but keep project selector
            const selector = main.querySelector(".project-selector");
            removeCurrentPage();
            if (selector) main.appendChild(selector);
            
            // Recreate page content based on the current page type
            switch(pageType) {
                case "sast":
                    createSastReportPage(main);
                    break;
                case "secret_detection": // New case for Secret Detection
                    createSecretDetectionReportPage(main);
                    break;
                case "dast":
                    createDastReportPage(main);
                    break;
                case "dependency_scanning":
                    createDCheckReportPage(main);
                    break;
                case "container_scanning":
                    createContScanReportPage(main);
                    break;
                case "fuzzing":
                    createFuzzingReportPage(main);
                    break;
                case "overview":
                    createOverviewReportPage();
                    break;
            }
        }

        function createVulnerabilityTable(vulnerabilities, type) {
            if (!vulnerabilities || vulnerabilities.length === 0) {
                return `<p class="no-vulnerabilities">No ${type} vulnerabilities found.</p>`;
            }

            let tableHTML = `
                <table class="vulnerability-table">
                    <thead>
                        <tr>
                            <th>Severity</th>
                            <th>Type/CVE</th>
                            <th>Location</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            vulnerabilities.forEach(vuln => {
                // Determine location based on available fields in the vulnerability object
                const location = vuln.file ? `${vuln.file}:${vuln.line}` : 
                                vuln.url ? vuln.url : 
                                vuln.package ? `${vuln.package} (${vuln.version})` :
                                vuln.endpoint ? vuln.endpoint : 
                                vuln.location ? vuln.location : 'N/A'; // Use generic location if available
                
                // Determine type information
                const typeInfo = vuln.type || vuln.cve || 'Unknown';
                
                tableHTML += `
                    <tr class="severity-${vuln.severity.toLowerCase()}">
                        <td><span class="severity-badge ${vuln.severity.toLowerCase()}">${vuln.severity}</span></td>
                        <td>${typeInfo}</td>
                        <td>${location}</td>
                        <td>${vuln.description}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            return tableHTML;
        }

        function createSummaryCards(summary) {
            return `
                <div class="summary-cards">
                    <div class="summary-card high">
                        <h4>High</h4>
                        <span class="count">${summary.high}</span>
                    </div>
                    <div class="summary-card medium">
                        <h4>Medium</h4>
                        <span class="count">${summary.medium}</span>
                    </div>
                    <div class="summary-card low">
                        <h4>Low</h4>
                        <span class="count">${summary.low}</span>
                    </div>
                    <div class="summary-card total">
                        <h4>Total</h4>
                        <span class="count">${summary.total}</span>
                    </div>
                </div>
            `;
        }

        function createSastReportPage(parentContainer) {
            const project = getCurrentProject();
            // Access the loaded SAST data for the current project
            const data = mockArtifactData[project].sast;
            
            // Add project selector if not already present
            if (!parentContainer.querySelector(".project-selector")) {
                parentContainer.appendChild(createProjectSelector());
            }
            
            const content = document.createElement("div");
            content.className = "report-content";
            content.innerHTML = `
                <h2>SAST Report - ${project.toUpperCase()}</h2>
                ${createSummaryCards(data.summary)}
                <div class="vulnerabilities-section">
                    <h3>Vulnerabilities Found</h3>
                    ${createVulnerabilityTable(data.vulnerabilities, "SAST")}
                </div>
            `;
            
            parentContainer.appendChild(content);
        }

        // New function to create the Secret Detection report page
        function createSecretDetectionReportPage(parentContainer) {
            const project = getCurrentProject();
            // Access the loaded Secret Detection data for the current project
            const data = mockArtifactData[project].secret_detection;
            
            // Add project selector if not already present
            if (!parentContainer.querySelector(".project-selector")) {
                parentContainer.appendChild(createProjectSelector());
            }
            
            const content = document.createElement("div");
            content.className = "report-content";
            content.innerHTML = `
                <h2>Secret Detection Report - ${project.toUpperCase()}</h2>
                ${createSummaryCards(data.summary)}
                <div class="vulnerabilities-section">
                    <h3>Secrets Found</h3>
                    ${createVulnerabilityTable(data.vulnerabilities, "Secret Detection")}
                </div>
            `;
            
            parentContainer.appendChild(content);
        }

        function createDastReportPage(parentContainer) {
            const project = getCurrentProject();
            const data = mockArtifactData[project].dast;
            
            if (!parentContainer.querySelector(".project-selector")) {
                parentContainer.appendChild(createProjectSelector());
            }
            
            const content = document.createElement("div");
            content.className = "report-content";
            content.innerHTML = `
                <h2>DAST Report - ${project.toUpperCase()}</h2>
                ${createSummaryCards(data.summary)}
                <div class="vulnerabilities-section">
                    <h3>Vulnerabilities Found</h3>
                    ${createVulnerabilityTable(data.vulnerabilities, "DAST")}
                </div>
            `;
            
            parentContainer.appendChild(content);
        }

        function createFuzzingReportPage(parentContainer) {
            const project = getCurrentProject();
            const data = mockArtifactData[project].fuzzing;
            
            if (!parentContainer.querySelector(".project-selector")) {
                parentContainer.appendChild(createProjectSelector());
            }
            
            const content = document.createElement("div");
            content.className = "report-content";
            content.innerHTML = `
                <h2>Fuzzing Report - ${project.toUpperCase()}</h2>
                ${createSummaryCards(data.summary)}
                <div class="vulnerabilities-section">
                    <h3>Vulnerabilities Found</h3>
                    ${createVulnerabilityTable(data.vulnerabilities, "Fuzzing")}
                </div>
            `;
            
            parentContainer.appendChild(content);
        }

        function createContScanReportPage(parentContainer) {
            const project = getCurrentProject();
            const data = mockArtifactData[project].container_scanning;
            
            if (!parentContainer.querySelector(".project-selector")) {
                parentContainer.appendChild(createProjectSelector());
            }
            
            const content = document.createElement("div");
            content.className = "report-content";
            content.innerHTML = `
                <h2>Container Scanning Report - ${project.toUpperCase()}</h2>
                ${createSummaryCards(data.summary)}
                <div class="vulnerabilities-section">
                    <h3>Vulnerabilities Found</h3>
                    ${createVulnerabilityTable(data.vulnerabilities, "Container Scanning")}
                </div>
            `;
            
            parentContainer.appendChild(content);
        }

        function createDCheckReportPage(parentContainer) {
            const project = getCurrentProject();
            const data = mockArtifactData[project].dependency_scanning;
            
            if (!parentContainer.querySelector(".project-selector")) {
                parentContainer.appendChild(createProjectSelector());
            }
            
            const content = document.createElement("div");
            content.className = "report-content";
            content.innerHTML = `
                <h2>Dependency Check Report - ${project.toUpperCase()}</h2>
                ${createSummaryCards(data.summary)}
                <div class="vulnerabilities-section">
                    <h3>Vulnerabilities Found</h3>
                    ${createVulnerabilityTable(data.vulnerabilities, "Dependency Check")}
                </div>
            `;
            
            parentContainer.appendChild(content);
        }

        function createOverviewReportPage() {
            const main = document.querySelector("main");
            const project = getCurrentProject();
            const projectData = mockArtifactData[project];
            
            if (!main.querySelector(".project-selector")) {
                main.appendChild(createProjectSelector());
            }
            
            const content = document.createElement("div");
            content.className = "report-content overview";
            
            let overviewHTML = `<h2>Security Overview - ${project.toUpperCase()}</h2>`;
            
            // Create overview cards for each scan type
            // Iterate over the keys of projectData to dynamically create overview cards
            Object.keys(projectData).forEach(scanType => {
                const data = projectData[scanType];
                // Format scan type name for display (e.g., "secret_detection" becomes "SECRET DETECTION")
                const scanName = scanType.replace(/_/g, ' ').toUpperCase();
                
                overviewHTML += `
                    <div class="overview-card">
                        <h3>${scanName}</h3>
                        <div class="overview-summary">
                            <span class="high">High: ${data.summary.high}</span>
                            <span class="medium">Medium: ${data.summary.medium}</span>
                            <span class="low">Low: ${data.summary.low}</span>
                            <span class="total">Total: ${data.summary.total}</span>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = overviewHTML;
            main.appendChild(content);
        }

        function createConfigPage() {
            const main = document.querySelector("main");
            main.classList.add("main-config-background");
            
            const content = document.createElement("div");
            content.className = "config-content";
            content.innerHTML = `
                <h2>Configuration Settings</h2>
                <form class="config-form">
                    <div class="config-form-div">
                        <label class="config-form-label" for="gitlab-instance">GitLab Instance</label>
                        <input class="config-form-input" type="text" id="gitlab-instance" 
                               placeholder="gitlab.example.com" value="lv-gitlab.intern.th-ab.de">
                    </div>
                    <div class="config-form-div">
                        <label class="config-form-label" for="project-id">Project ID</label>
                        <input class="config-form-input" type="number" id="project-id" 
                               placeholder="0000" value="1984">
                    </div>
                    <div class="config-form-div">
                        <label class="config-form-label" for="private-token">Private Token</label>
                        <div id="token-div">
                            <input class="config-form-input" type="password" id="private-token" 
                                   value="xRpjwyqZfW4YeaEUTsta">
                            <input type="checkbox" id="token-cb">
                        </div>
                    </div>
                    <fieldset class="config-form-fieldset">
                        <legend>Stages</legend>
                        <div class="config-form-div">
                            <label class="config-form-label" for="stage-0">SAST</label>
                            <input class="config-form-input" type="text" id="stage-0" 
                                   placeholder="./path/to/report" value="gl-sast-report.json">
                        </div>
                        <div class="config-form-div">
                            <label class="config-form-label" for="stage-secret-detection">Secret Detection</label>
                            <input class="config-form-input" type="text" id="stage-secret-detection" 
                                   placeholder="./path/to/report" value="gl-secret-detection-report.json">
                        </div>
                        <div class="config-form-div">
                            <label class="config-form-label" for="stage-1">Dependency check</label>
                            <input class="config-form-input" type="text" id="stage-1" 
                                   placeholder="./path/to/report" value="">
                        </div>
                        <div class="config-form-div">
                            <label class="config-form-label" for="stage-2">Container scanning</label>
                            <input class="config-form-input" type="text" id="stage-2" 
                                   placeholder="./path/to/report" value="">
                        </div>
                        <div class="config-form-div">
                            <label class="config-form-label" for="stage-3">Fuzzing</label>
                            <input class="config-form-input" type="text" id="stage-3" 
                                   placeholder="./path/to/report" value="">
                        </div>
                        <div class="config-form-div">
                            <label class="config-form-label" for="stage-4">DAST</label>
                            <input class="config-form-input" type="text" id="stage-4" 
                                   placeholder="./path/to/report" value="">
                        </div>
                    </fieldset>
                    <button type="button" class="config-form-btn btn-allowed">Set Configuration</button>
                </form>
            `;
            
            main.appendChild(content);
            
            // Add event listeners
            const tokenCheckbox = document.getElementById("token-cb");
            tokenCheckbox.addEventListener('change', (e) => {
                const tokenInput = document.getElementById("private-token");
                tokenInput.type = e.target.checked ? "text" : "password";
            });
            
            const configBtn = content.querySelector('.config-form-btn');
            configBtn.addEventListener('click', () => {
                alert('Configuration saved! (This is a demo - actual saving would require backend integration)');
            });
        }

        //EVENT LISTENERS//
        btnOverview.addEventListener("click", async (e) => { // Added async
            if(currentPage == OVERVIEW_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            createOverviewReportPage();
            disableReportBtns(false);
            removeSelector(BTN_ALLOWED_ACTIVE, ".", btnLastPVul, btnPreVul);
            e.target.classList.add(BTN_ALLOWED_ACTIVE);
            currentPage = OVERVIEW_PAGE;
        });

        btnSast.addEventListener("click", async (e) => { // Added async
            if(currentPage == SAST_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            const main = document.querySelector("main");
            createSastReportPage(main);
            removeSelector(BTN_ALLOWED_ACTIVE, ".", btnLastPVul, btnPreVul);
            e.target.classList.add(BTN_ALLOWED_ACTIVE);
            currentPage = SAST_PAGE;
        });

        // New event listener for Secret Detection button
        btnSecretDetection.addEventListener("click", async (e) => { // Added async
            if(currentPage == SECRET_DETECTION_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            const main = document.querySelector("main");
            createSecretDetectionReportPage(main); 
            removeSelector(BTN_ALLOWED_ACTIVE, ".", btnLastPVul, btnPreVul);
            e.target.classList.add(BTN_ALLOWED_ACTIVE);   
            currentPage = SECRET_DETECTION_PAGE;
        });

        btnDCheck.addEventListener("click", async (e) => { // Added async
            if(currentPage == D_CHECK_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            const main = document.querySelector("main");
            createDCheckReportPage(main);
            removeSelector(BTN_ALLOWED_ACTIVE, ".", btnLastPVul, btnPreVul);
            e.target.classList.add(BTN_ALLOWED_ACTIVE);
            currentPage = D_CHECK_PAGE;
        });

        btnContainerScanning.addEventListener("click", async (e) => { // Added async
            if(currentPage == CONT_SCAN_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            const main = document.querySelector("main");
            createContScanReportPage(main);
            removeSelector(BTN_ALLOWED_ACTIVE, ".", btnLastPVul, btnPreVul);
            e.target.classList.add(BTN_ALLOWED_ACTIVE);
            currentPage = CONT_SCAN_PAGE;
        });

        btnFuzzing.addEventListener("click", async (e) => { // Added async
            if(currentPage == FUZZING_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            const main = document.querySelector("main");
            createFuzzingReportPage(main); 
            removeSelector(BTN_ALLOWED_ACTIVE, ".", btnLastPVul, btnPreVul);
            e.target.classList.add(BTN_ALLOWED_ACTIVE);   
            currentPage = FUZZING_PAGE;
        });

        btnDast.addEventListener("click", async (e) => { // Added async
            if(currentPage == DAST_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            const main = document.querySelector("main");
            createDastReportPage(main); 
            removeSelector(BTN_ALLOWED_ACTIVE, ".", btnLastPVul, btnPreVul);
            e.target.classList.add(BTN_ALLOWED_ACTIVE);   
            currentPage = DAST_PAGE;
        });

        btnLastPVul.addEventListener("click", async (e) => { // Added async
            if(currentPage == LASTPVUL_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            createOverviewReportPage();
            disableReportBtns(false);
            removeSelector(BTN_ALLOWED_ACTIVE, ".");   
            e.target.classList.add(BTN_ALLOWED_ACTIVE);
            document.getElementById("overview").classList.add(BTN_ALLOWED_ACTIVE);
            currentPage = OVERVIEW_PAGE;
        });

        btnPreVul.addEventListener("click", async (e) => { // Added async
            if(currentPage == OVERVIEW_PAGE) return;
            removeCurrentPage();
            await loadArtifactData(); // Ensure data is loaded before rendering
            createOverviewReportPage();
            disableReportBtns(false);
            removeSelector(BTN_ALLOWED_ACTIVE, ".");    
            e.target.classList.add(BTN_ALLOWED_ACTIVE);
            document.getElementById("overview").classList.add(BTN_ALLOWED_ACTIVE);
            currentPage = OVERVIEW_PAGE;
        });

        btnChConfig.addEventListener("click", (e) => {
            if(currentPage == CONFIG_PAGE) return;
            removeCurrentPage();
            createConfigPage();
            disableReportBtns(true);
            removeSelector(BTN_ALLOWED_ACTIVE, ".");   
            e.target.classList.add(BTN_ALLOWED_ACTIVE);
            currentPage = CONFIG_PAGE;
        });

        // Initial data load when the page loads
        document.addEventListener('DOMContentLoaded', loadArtifactData);
    </script>
</body>
</html>

